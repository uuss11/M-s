<!DOCTYPE html><html lang="ar">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ØªØªØ¨Ø¹ Ø§Ù„ÙŠØ¯ ÙˆØ§Ù„Ø¬Ø²ÙŠØ¦Ø§Øª â€” ØªØ­ÙƒÙ… Ù…ØªÙ‚Ø¯Ù…</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        canvas { display: block; }
        #overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85);
            display: flex; justify-content: center; align-items: center;
            z-index: 1000; flex-direction: column; gap: 16px;
        }
        button {
            padding: 12px 28px; font-size: 1.1rem; cursor: pointer;
            border: none; border-radius: 999px; background: #ff4757; color: white;
            box-shadow: 0 6px 20px rgba(255,71,87,0.28); transition: 0.18s;
        }
        #status { position: fixed; bottom: 14px; left: 0; right: 0; text-align: center; color: #fff; z-index: 10; }
        #legend{
            position: fixed;
            top: 12px;
            left: 12px;
            padding: 10px 12px;
            background: rgba(0,0,0,0.55);
            color: #fff;
            font-size: 0.85rem;
            line-height: 1.6;
            border-radius: 10px;
            z-index: 30;
            backdrop-filter: blur(6px);
            box-shadow: 0 6px 18px rgba(0,0,0,.45);
            max-width: 220px;
        }
        #legend b{ display:block; margin-bottom:4px; }/* Ù†Ø§ÙØ°Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ */
    #camBox{
        position: fixed; bottom: 12px; right: 12px; width: 200px; height: 150px;
        border-radius: 14px; overflow: hidden; z-index: 20;
        border: 2px solid rgba(255,255,255,0.4);
        box-shadow: 0 10px 25px rgba(0,0,0,.6);
    }
    #camBox video{ width:100%; height:100%; object-fit: cover; transform: scaleX(-1); }
</style>

</head>
<body><div id="overlay">
    <h2 style="color:#fff;margin:0">ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ÙŠØ¯</h2>
    <button id="startButton">Ø§Ø¨Ø¯Ø£</button>
</div><div id="status">Ø¬Ø§Ù‡Ø²</div><!-- ØµÙ†Ø¯ÙˆÙ‚ Ø´Ø±Ø­ Ø§Ù„Ø­Ø±ÙƒØ§Øª --><div id="legend">
  <b>ğŸ® Ø­Ø±ÙƒØ§Øª Ø§Ù„ØªØ­ÙƒÙ…</b><br>
  ğŸ– ØªØ­Ø±ÙŠÙƒ Ø§Ù„ÙŠØ¯: ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¬Ø²ÙŠØ¦Ø§Øª<br>
  ğŸ¤ Ù‚Ø±ØµØ©: ØªÙƒØ¨ÙŠØ± / ØªØµØºÙŠØ±<br>
  âœŒï¸ Ø¥ØµØ¨Ø¹ÙŠÙ†: ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ù„ÙˆØ§Ù†<br>
  ğŸ‘ Ø¥Ø¨Ù‡Ø§Ù… Ù„ÙÙˆÙƒ: ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ±Ø§Ù†<br>
  ğŸ¤˜ Ø±ÙˆÙƒ: ØªÙØ¬ÙŠØ± Ø§Ù„Ø¬Ø²ÙŠØ¦Ø§Øª<br>
  ğŸ– ÙŠØ¯ Ù…ÙØªÙˆØ­Ø©: ØªØ¬Ù…ÙŠØ¯<br>
  ğŸ‘‹ ØªÙ„ÙˆÙŠØ­: Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·
</div><div id="camBox"><video id="camPreview" autoplay muted playsinline></video></div><script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script><script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script><script type="module">
import * as THREE from 'https://cdn.skypack.dev/three@0.132.2';

const startButton = document.getElementById('startButton');
const overlay = document.getElementById('overlay');
const statusText = document.getElementById('status');
const camPreview = document.getElementById('camPreview');

// ----- Ù…Ø´Ù‡Ø¯ Three -----
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);
camera.position.z = 85;

// ----- Ø¬Ø²ÙŠØ¦Ø§Øª -----
const COUNT = 2000;
const geo = new THREE.BufferGeometry();
const pos = new Float32Array(COUNT*3);
const col = new Float32Array(COUNT*3);

for(let i=0;i<COUNT;i++){
    pos[i*3]=(Math.random()-0.5)*120;
    pos[i*3+1]=(Math.random()-0.5)*120;
    pos[i*3+2]=(Math.random()-0.5)*120;
    col[i*3]=0.6; col[i*3+1]=0.6; col[i*3+2]=1;
}
geo.setAttribute('position', new THREE.BufferAttribute(pos,3));
geo.setAttribute('color', new THREE.BufferAttribute(col,3));

const mat = new THREE.PointsMaterial({ size:0.9, vertexColors:true, transparent:true, blending:THREE.AdditiveBlending });
const particles = new THREE.Points(geo, mat);
scene.add(particles);

// ----- Ø£Ø´ÙƒØ§Ù„ -----
const heart=(t)=> new THREE.Vector3(
  16*Math.pow(Math.sin(t),3),
  13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t),0
);
const sphere=(i)=>{
  const phi=Math.acos(-1+2*i/COUNT);
  const th=Math.sqrt(COUNT*Math.PI)*phi;
  return new THREE.Vector3().setFromSphericalCoords(22,phi,th);
};

// ----- Mediapipe -----
let hx=0, hy=0, scale=1, rotSpeed=0.002, freeze=false;
let colorMode=0;

const video=document.createElement('video');
video.autoplay=true; video.muted=true; video.playsInline=true;

const hands=new Hands({ locateFile:(f)=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}` });
hands.setOptions({ maxNumHands:1, minDetectionConfidence:.6, minTrackingConfidence:.6 });

let lastWaveX=null;

hands.onResults(r=>{
 if(!r.multiHandLandmarks) return;
 const lm=r.multiHandLandmarks[0];

 // Ø­Ø±ÙƒØ© Ø§Ù„ÙŠØ¯
 hx=(lm[8].x-.5)*window.innerWidth*0.06;
 hy=-(lm[8].y-.5)*window.innerHeight*0.045;

 // Ø­Ø¬Ù… (Ù‚Ø±ØµØ©)
 const dx=lm[4].x-lm[8].x;
 const dy=lm[4].y-lm[8].y;
 scale=Math.max(.6,Math.sqrt(dx*dx+dy*dy)*8);

 // âœŒï¸ Ø¥ØµØ¨Ø¹ÙŠÙ† = ØªØºÙŠÙŠØ± Ù„ÙˆÙ†
 if(lm[8].y<lm[6].y && lm[12].y<lm[10].y && lm[16].y>lm[14].y){
   colorMode=(colorMode+1)%3;
 }

 // ğŸ‘ Ø¥Ø¨Ù‡Ø§Ù… Ù„ÙÙˆÙƒ = Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Ù†
 if(lm[4].y < lm[3].y){ rotSpeed=0.01; }
 else rotSpeed=0.002;

 // ğŸ– ÙŠØ¯ Ù…ÙØªÙˆØ­Ø© = ØªØ¬Ù…ÙŠØ¯
 const openHand = lm[8].y<lm[6].y && lm[12].y<lm[10].y && lm[16].y<lm[14].y && lm[20].y<lm[18].y;
 freeze=openHand;

 // ğŸ¤˜ ØªÙØ¬ÙŠØ±
 const rock = lm[8].y<lm[6].y && lm[20].y<lm[18].y && lm[12].y>lm[10].y && lm[16].y>lm[14].y;
 if(rock){ for(let i=0;i<COUNT;i++){ pos[i*3]+=(Math.random()-.5)*40; pos[i*3+1]+=(Math.random()-.5)*40; }}

 // ğŸ‘‹ ØªÙ„ÙˆÙŠØ­ = Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·
 if(lastWaveX!==null && Math.abs(lm[8].x-lastWaveX)>.15){
    for(let i=0;i<COUNT;i++){
      pos[i*3]=(Math.random()-.5)*120;
      pos[i*3+1]=(Math.random()-.5)*120;
      pos[i*3+2]=(Math.random()-.5)*120;
    }
 }
 lastWaveX=lm[8].x;
});

startButton.onclick=async()=>{
 overlay.style.display='none';
 const cam=new Camera(video,{ onFrame:async()=>hands.send({image:video}), width:640, height:480 });
 camPreview.srcObject=video.srcObject;
 await cam.start();
 animate();
};

let t=0;
function animate(){
 requestAnimationFrame(animate);
 if(!freeze){ t+=0.01; }
 for(let i=0;i<COUNT;i++){
   const trg=sphere(i).multiplyScalar(scale);
   pos[i*3]+= (trg.x+hx-pos[i*3])*.1;
   pos[i*3+1]+= (trg.y+hy-pos[i*3+1])*.1;
   pos[i*3+2]+= (trg.z-pos[i*3+2])*.1;
   if(colorMode===1){ col[i*3]=1; col[i*3+1]=.4; }
   if(colorMode===2){ col[i*3]=.4; col[i*3+1]=1; }
 }
 geo.attributes.position.needsUpdate=true;
 geo.attributes.color.needsUpdate=true;
 particles.rotation.y+=rotSpeed;
 renderer.render(scene,camera);
}

window.addEventListener('resize',()=>{
 camera.aspect=window.innerWidth/window.innerHeight;
 camera.updateProjectionMatrix();
 renderer.setSize(window.innerWidth,window.innerHeight);
});
</script></body>
</html>
