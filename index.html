<!doctype html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>AR Ultimate Hand & Body Control</title>
    <style>
        :root { --neon: #00ffcc; --bg: #050505; }
        body { margin: 0; overflow: hidden; background: var(--bg); font-family: sans-serif; }
        
        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª */
        #ui-guide {
            position: fixed; top: 20px; right: 20px; background: rgba(0,0,0,0.8);
            color: white; padding: 20px; border-radius: 15px; border: 1px solid var(--neon);
            z-index: 100; pointer-events: none; width: 250px;
        }
        #ui-guide h3 { margin: 0 0 10px 0; color: var(--neon); font-size: 1.1rem; }
        #ui-guide li { margin-bottom: 8px; font-size: 0.9rem; list-style: none; }

        #camPreview { position: fixed; inset: 0; width: 100vw; height: 100vh; object-fit: cover; transform: scaleX(-1); z-index: 1; opacity: 0.3; }
        canvas { position: fixed; inset: 0; z-index: 10; }
        
        #overlay { position: fixed; inset: 0; background: var(--bg); display: flex; align-items: center; justify-content: center; z-index: 1000; flex-direction: column; color: white; }
        button { padding: 18px 60px; border-radius: 50px; border: 2px solid var(--neon); background: transparent; color: var(--neon); cursor: pointer; font-size: 1.3rem; font-weight: bold; transition: 0.3s; }
        button:hover { background: var(--neon); color: black; box-shadow: 0 0 30px var(--neon); }
        
        #status { position: fixed; bottom: 30px; width: 100%; text-align: center; color: var(--neon); z-index: 100; font-weight: bold; text-transform: uppercase; letter-spacing: 2px; }
    </style>
</head>
<body>

<div id="ui-guide">
    <h3>ğŸ® Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø°ÙƒÙŠ</h3>
    <ul>
        <li>ğŸ”¹ <b>Ø­Ø±Ùƒ ÙŠØ¯Ùƒ:</b> Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¬Ø²ÙŠØ¦Ø§Øª</li>
        <li>ğŸ”¹ <b>Ø£ØºÙ„Ù‚ Ø£ØµØ§Ø¨Ø¹Ùƒ ğŸ¤:</b> Ø¶ØºØ· Ø§Ù„Ø´ÙƒÙ„ ÙˆØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ†</li>
        <li>ğŸ”¹ <b>ØªÙƒÙ„Ù…:</b> "Ø£Ø­Ù…Ø±"ØŒ "Ø£Ø®Ø¶Ø±"ØŒ "Ø£Ø²Ø±Ù‚"</li>
    </ul>
</div>

<div id="overlay">
    <h1 style="letter-spacing: 5px;">ENGINE <span style="color:var(--neon)">V6-PRO</span></h1>
    <p style="opacity: 0.5; margin-bottom: 40px;">Ù†Ø¸Ø§Ù… ØªØªØ¨Ø¹ Ø§Ù„ÙŠØ¯ ÙˆØ§Ù„Ø¬Ø³Ù… ÙØ§Ø¦Ù‚ Ø§Ù„Ø¯Ù‚Ø©</p>
    <button id="startButton">Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</button>
</div>

<div id="status">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¥Ø°Ù†...</div>
<video id="camPreview" playsinline muted></video>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/holistic/holistic.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script type="module">
import * as THREE from 'https://cdn.skypack.dev/three@0.132.2';

const videoEl = document.getElementById('camPreview');
const statusText = document.getElementById('status');

// 1. Ø¥Ø¹Ø¯Ø§Ø¯ Three.js Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);
camera.position.z = 100;

// Ø¥Ø¶Ø§ÙØ© Ø´ÙƒÙ„ Ù‡Ù†Ø¯Ø³ÙŠ Ù…Ø±ÙƒØ²ÙŠ (Torus Knot)
const knotGeo = new THREE.TorusKnotGeometry(15, 4, 150, 20);
const knotMat = new THREE.MeshBasicMaterial({ color: 0x00ffcc, wireframe: true, transparent: true, opacity: 0.2 });
const knot = new THREE.Mesh(knotGeo, knotMat);
scene.add(knot);

// Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø²ÙŠØ¦Ø§Øª Ø§Ù„Ø°ÙƒÙŠ
const COUNT = 2500;
const positions = new Float32Array(COUNT * 3);
const colors = new Float32Array(COUNT * 3);
for(let i=0; i<COUNT*3; i++) positions[i] = (Math.random()-0.5)*250;

const geo = new THREE.BufferGeometry();
geo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
geo.setAttribute('color', new THREE.BufferAttribute(colors, 3));
const mat = new THREE.PointsMaterial({ size: 1.2, vertexColors: true, blending: THREE.AdditiveBlending, transparent: true });
const particles = new THREE.Points(geo, mat);
scene.add(particles);

let targetPos = new THREE.Vector3(0,0,0);
let particleColor = new THREE.Color(0x00ffcc);
let pulseScale = 1;

// 2. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØµÙˆØªÙŠØ© (Ø¹Ø±Ø¨ÙŠ Ù…Ø±Ù†)
function cleanArabic(text) {
    return text.replace(/[Ø£Ø¥Ø¢Ø§]/g, 'Ø§').replace(/Ø©/g, 'Ù‡').trim();
}

const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
if(Speech) {
    const rec = new Speech();
    rec.continuous = true;
    rec.lang = 'ar-SA';
    rec.onresult = (e) => {
        const word = cleanArabic(e.results[e.results.length-1][0].transcript);
        if(word.includes("Ø§Ø­Ù…Ø±")) particleColor.set(0xff4444);
        if(word.includes("Ø§Ø®Ø¶Ø±")) particleColor.set(0x44ff44);
        if(word.includes("Ø§Ø²Ø±Ù‚")) particleColor.set(0x4444ff);
        statusText.innerText = "Ø£Ù…Ø± ØµÙˆØªÙŠ: " + word;
    };
    rec.start();
}

// 3. Ø¥Ø¹Ø¯Ø§Ø¯ MediaPipe Holistic (Ø£ÙØ¶Ù„ Ù…ÙƒØªØ¨Ø© Ù„Ù„ÙŠØ¯ ÙˆØ§Ù„Ø¬Ø³Ù…)
const holistic = new window.Holistic({
    locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/holistic/${file}`
});

holistic.setOptions({
    modelComplexity: 1,
    smoothLandmarks: true,
    minDetectionConfidence: 0.6,
    minTrackingConfidence: 0.6
});

holistic.onResults((res) => {
    // ØªØªØ¨Ø¹ Ø§Ù„ÙŠØ¯ Ø§Ù„ÙŠÙ…Ù†Ù‰ Ø¨Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ©
    if (res.rightHandLandmarks) {
        const tip = res.rightHandLandmarks[8]; // Ø§Ù„Ø³Ø¨Ø§Ø¨Ø©
        const thumb = res.rightHandLandmarks[4]; // Ø§Ù„Ø¥Ø¨Ù‡Ø§Ù…
        
        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ù„Ù„ÙØ¶Ø§Ø¡ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ
        targetPos.x = -(tip.x - 0.5) * 150;
        targetPos.y = -(tip.y - 0.5) * 100;
        
        // ÙƒØ´Ù Ø­Ø±ÙƒØ© "Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ" (Pinch)
        const dist = Math.hypot(tip.x - thumb.x, tip.y - thumb.y);
        if(dist < 0.07) {
            pulseScale = 0.2;
            particleColor.set(0xffaa00);
            statusText.innerText = "ØªÙ… Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ Ø¨Ø§Ù„Ø´ÙƒÙ„ ğŸ¤";
        } else {
            pulseScale = 1.0;
            statusText.innerText = "ØªØ­Ø±Ùƒ Ø¨Ø­Ø±ÙŠØ© ğŸ–ï¸";
        }
    }
});

// 4. Ø­Ù„Ù‚Ø© Ø§Ù„ØªØ­Ø±ÙŠÙƒ (Animation Loop)
function animate() {
    requestAnimationFrame(animate);
    
    knot.rotation.x += 0.005;
    knot.rotation.y += 0.01;
    knot.position.lerp(targetPos, 0.1);

    const posAttr = geo.attributes.position;
    const colAttr = geo.attributes.color;

    for (let i = 0; i < COUNT; i++) {
        const i3 = i * 3;
        // Ø­Ø±ÙƒØ© Ø§Ù„Ø¬Ø²ÙŠØ¦Ø§Øª Ø­ÙˆÙ„ Ù†Ù‚Ø·Ø© Ø§Ù„ØªØ­ÙƒÙ…
        const angle = i * 0.1 + Date.now() * 0.001;
        const radius = 25 * pulseScale;
        
        const tx = targetPos.x + Math.cos(angle) * radius * (i/COUNT * 2);
        const ty = targetPos.y + Math.sin(angle) * radius * (i/COUNT * 2);
        const tz = targetPos.z + Math.sin(angle * 0.5) * radius;

        posAttr.array[i3] += (tx - posAttr.array[i3]) * 0.1;
        posAttr.array[i3+1] += (ty - posAttr.array[i3+1]) * 0.1;
        posAttr.array[i3+2] += (tz - posAttr.array[i3+2]) * 0.1;

        colAttr.setXYZ(i, particleColor.r, particleColor.g, particleColor.b);
    }
    posAttr.needsUpdate = true;
    colAttr.needsUpdate = true;
    renderer.render(scene, camera);
}

// 5. Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
document.getElementById('startButton').onclick = () => {
    document.getElementById('overlay').style.display = 'none';
    const cameraHelper = new window.Camera(videoEl, {
        onFrame: async () => { await holistic.send({ image: videoEl }); },
        width: 1280, height: 720
    });
    cameraHelper.start().then(() => {
        statusText.innerText = "Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ - Ø§Ø±ÙØ¹ ÙŠØ¯Ùƒ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§";
        animate();
    });
};

window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
